<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="geochemdb" href="modules.html" /><link rel="prev" title="Contents" href="index.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2025.07.19 -->
        <title>geochemdb guide - geochemdb unknown documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=25af2a20" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">geochemdb unknown documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <span class="sidebar-brand-text">geochemdb unknown documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Guide</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="modules.html">Module Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Module Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="geochemdb.html">geochemdb package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/guide.ipynb.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="geochemdb-guide">
<h1><code class="docutils literal notranslate"><span class="pre">geochemdb</span></code> guide<a class="headerlink" href="#geochemdb-guide" title="Link to this heading">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">geochemdb</span>
</pre></div>
</div>
</div>
</div>
<p>This notebook provides example utilization of the module with some example zircon laser ablation data reduced by Iolite 4. You will also need to have <a class="reference external" href="https://github.com/sarttiso/iolite_tools">iolite_tools</a> to facilitate processing the example dataset into dataframes that are ready for <code class="docutils literal notranslate"><span class="pre">geochemdb</span></code>.</p>
<p>This notebook assumes that you are working from the preconfigured example database <code class="docutils literal notranslate"><span class="pre">geochemdb_example.db</span></code>, which is in the <em>example_data</em> directory.</p>
<p>For use with your own data, you will also need to have properly configured a database. The <a class="reference internal" href="#schema.sql"><span class="xref myst">schema.sql</span></a> is available in the repository. For your own database, you can use the schema to create an empty database file with the correct tables and relationships by running</p>
<p><code class="docutils literal notranslate"><span class="pre">sqlite3</span> <span class="pre">your-geochem-database.db</span> <span class="pre">&lt;</span> <span class="pre">schema.sql</span></code></p>
<p>at a command line after having installed sqlite3 (which can be done via anaconda).</p>
<p>Alternatively, you can copy <code class="docutils literal notranslate"><span class="pre">geochemdb_example.db</span></code> and edit it using a program like the free <a class="reference external" href="https://sqlitestudio.pl/">SQLiteStudio</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">iolite_tools</span>
</pre></div>
</div>
</div>
</div>
<section id="create-geochemdb-object">
<h2>Create <code class="docutils literal notranslate"><span class="pre">GeochemDB</span></code> Object<a class="headerlink" href="#create-geochemdb-object" title="Link to this heading">¶</a></h2>
<p>The core class for the <code class="docutils literal notranslate"><span class="pre">geochemdb</span></code> module is <code class="docutils literal notranslate"><span class="pre">GeochemDB</span></code>, which generates an object that allows you to interface with a geochemical SQLite database.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">example_data</span></code> directory can be found at the root of the repository on <a class="reference external" href="https://github.com/sarttiso/geochemdb">Github</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">database_path</span> <span class="o">=</span> <span class="s1">&#39;example_data/geochemdb_example.db&#39;</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">geochemdb</span><span class="o">.</span><span class="n">GeochemDB</span><span class="p">(</span><span class="n">database_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This object allows you to</p>
<ul class="simple">
<li><p>add</p></li>
<li><p>update</p></li>
<li><p>retrieve</p></li>
</ul>
<p>measurements from the database.</p>
<p>This guide walks through each of these steps.</p>
</section>
<section id="adding-measurements">
<h2>Adding Measurements<a class="headerlink" href="#adding-measurements" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">GeochemDB.measurements_add()</span></code> adds new measurements to the <em>Measurements</em> table of the database.</p>
<p><strong>Note:</strong> <em><code class="docutils literal notranslate"><span class="pre">GeochemDB.measurements_add()</span></code> does not add missing samples to the <code class="docutils literal notranslate"><span class="pre">Samples</span></code> table.</em> Samples should be added to the database manually with all of their corresponding metadata.</p>
<p>To add measurements to the database, you have to provide three dataframes:</p>
<ol class="arabic simple">
<li><p><strong>measurements</strong> : This dataframe contains geochemical measurements as rows, alongside analysis names. Measurements are the values of geochemical concentrations or ratios, along with their uncertainties.</p></li>
<li><p><strong>analyses</strong> : This dataframe lists analyses and metadata. An analysis refers to measurement of an aliquot by a machine. All analyses referenced in measurements should be present here. No other analyses should be present.</p></li>
<li><p><strong>aliquots</strong> : This dataframe contains aliquots to which analyses belong. An aliquot is a portion of a sample. All aliquots referenced in the analsyes dataframe should be present here. No other aliquots should be present.</p></li>
</ol>
<p>In the example here, measurements are trace element, U, and Pb concentrations in zircons via laser ablation. These measurements were gathered via the split-stream configuration at the UCSB petrochronology lab. This procedure takes the aerosol generated via laser ablation and splits it, delivering portions to different mass spectrometers (one to measure trace elements, another U and Pb).</p>
<p>In this case, an aliquot refers to the aerosol generated by the laser, which is designated by a spot number (e.g., <em>S_z48</em>). Each aliquot has two analyses: one for trace elements and another for U/Pb. Each analysis has as many measurements as the mass spectrometers were configured to collect.</p>
<p>The code below prepares the necessaary dataframes using example LASS-ICPMS datasets. I’ve developed <code class="docutils literal notranslate"><span class="pre">iolite_tools</span></code> to facilitate processing these reduced data from excel spreadsheets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">iolite_tools</span><span class="o">.</span><span class="n">excel2measurements</span><span class="p">(</span><span class="s1">&#39;example_data/2023-03_run-5_trace.xlsx&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;2023-03&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;trace&#39;</span><span class="p">)</span>

<span class="n">df_measurements</span> <span class="o">=</span> <span class="n">iolite_tools</span><span class="o">.</span><span class="n">measurements2sql</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">refmat</span><span class="o">=</span><span class="s1">&#39;91500&#39;</span><span class="p">)</span>
<span class="n">df_analyses</span> <span class="o">=</span> <span class="n">iolite_tools</span><span class="o">.</span><span class="n">analyses2sql</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="s1">&#39;2023-03-17&#39;</span><span class="p">,</span>
                                        <span class="n">instrument</span><span class="o">=</span><span class="s1">&#39;Nu Plasma 3D&#39;</span><span class="p">,</span>
                                        <span class="n">technique</span><span class="o">=</span><span class="s1">&#39;LASS ICPMS&#39;</span><span class="p">)</span>
<span class="n">df_aliquots</span> <span class="o">=</span> <span class="n">iolite_tools</span><span class="o">.</span><span class="n">aliquots2sql</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="s1">&#39;zircon&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>While <code class="docutils literal notranslate"><span class="pre">iolite_tools</span></code> is specifically designed for this particular type of data, the structure of the dataframes above is what is necessary for adding data to the database. As long as you can produce these dataframes from your own reduced datasets, then you will be able to add your own data.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You will have to make sure that the auxiliary tables have been appropriately populated with the relevant values before trying to add measurements. These tables include <em>MeasurementUnits</em>, <em>Quantities</em>, <em>QuantitiesMeasurementUnits</em>, <em>Instruments</em>, <em>Techniques</em>, and <em>Materials</em>. See <a class="reference internal" href="#readme.md"><span class="xref myst">readme</span></a> for more information. You will notice that the columns in the dataframes generated above reference these types of information, which is all about facilitating the metadata collection and standardization that is often lacking. The <code class="docutils literal notranslate"><span class="pre">geochem_example.db</span></code> database already has the values added, but you may have to add your own depending on your data collection and reduction practices.</p>
</div>
<p>Now that we have made the <em>measurements</em>, <em>analyses</em>, and <em>aliquots</em> dataframes, we can use <code class="docutils literal notranslate"><span class="pre">db.measurements_add()</span></code> to add them to the database.</p>
<p>Prior to running this function, however, you can check to see what samples will be matched based on the strings in the dataframes. The code uses fuzzy string matching on sample names, so it can be convenient to run <code class="docutils literal notranslate"><span class="pre">db.matchrows_strings()</span></code> to ensure that samples are being matched appropriately.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">matchrows_strings</span><span class="p">(</span><span class="s1">&#39;Samples&#39;</span><span class="p">,</span> <span class="n">df_aliquots</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">score_threshold</span><span class="o">=</span><span class="mi">95</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([False, False,  True, False, False, False]),
 {&#39;AT2310 16 4&#39;: &#39;AT2310 16.4&#39;})
</pre></div>
</div>
</div>
</div>
<p>We can see that only sample AT2310 16.4 is matched since it’s the only one in the database. If samples do not match, then they either are not present in the database and need to be added, or the sample names in the dataframes differ too much from the sample names in the database. The degree of string similarity for the fuzzy name matching is controlled by the <code class="docutils literal notranslate"><span class="pre">score_threshold</span></code> parameter, which can be decreased to match more dissimilar strings. In this case, a threshold of 95 is sufficient to match ‘AT2310 16 4’ to ‘AT2310 16.4’.</p>
<p>Once you’re satisfied that the dataframes are ready and sample names will match, you can add the measurements to the database.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">measurements_add</span><span class="p">(</span><span class="n">df_measurements</span><span class="p">,</span> <span class="n">df_analyses</span><span class="p">,</span> <span class="n">df_aliquots</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sample names not matched:
{&#39;91500&#39;, &#39;Ples&#39;, &#39;GJ1&#39;, &#39;AT22 FRAN 17 29&#39;, &#39;NIST612&#39;}
Added:
122 aliquots,
122 analyses,
3416 measurements
</pre></div>
</div>
</div>
</div>
</section>
<section id="updating-measurements">
<h2>Updating Measurements<a class="headerlink" href="#updating-measurements" title="Link to this heading">¶</a></h2>
<p>You might find that you’ve improved your data reduction at some point in the future, and you have new values for measurements from existing analyses. If you have already added these measurements to the database, you can update them using <code class="docutils literal notranslate"><span class="pre">db.measurements_update()</span></code>. Note that analysis names must be identical to the existing analyses in the database.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">measurements_update</span><span class="p">(</span><span class="n">df_measurements</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Updated:
3416 measurements
</pre></div>
</div>
</div>
</div>
</section>
<section id="get-measurements-by-sample">
<h2>Get Measurements by Sample<a class="headerlink" href="#get-measurements-by-sample" title="Link to this heading">¶</a></h2>
<p>Retrieving measurements from the database can be done with <code class="docutils literal notranslate"><span class="pre">db.measurements_by_sample()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_measurements</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">measurements_by_sample</span><span class="p">(</span><span class="s1">&#39;AT2310 16.4&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This function returns a dataframe with all measurements as rows, whereas most end-users will likely want measured quantities in columns. The <code class="docutils literal notranslate"><span class="pre">geochemdb.aliquot_average()</span></code> function generates such a dataframe by averaging aliquots with repeat measurements of any quantities.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_aliquots</span> <span class="o">=</span> <span class="n">geochemdb</span><span class="o">.</span><span class="n">aliquot_average</span><span class="p">(</span><span class="n">df_measurements</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="modules.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">geochemdb</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Home</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Adrian Tasistro-Hart
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">geochemdb</span></code> guide</a><ul>
<li><a class="reference internal" href="#create-geochemdb-object">Create <code class="docutils literal notranslate"><span class="pre">GeochemDB</span></code> Object</a></li>
<li><a class="reference internal" href="#adding-measurements">Adding Measurements</a></li>
<li><a class="reference internal" href="#updating-measurements">Updating Measurements</a></li>
<li><a class="reference internal" href="#get-measurements-by-sample">Get Measurements by Sample</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=3f1b9271"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>